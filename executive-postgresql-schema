--
-- PostgreSQL database dump
--

SET statement_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = off;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET escape_string_warning = off;

SET search_path = public, pg_catalog;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- Name: flights; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE flights (
    flight integer NOT NULL,
    started integer DEFAULT 0 NOT NULL,
    blessing text DEFAULT 'unknown'::text NOT NULL,
    branch text NOT NULL,
    intended text
);


ALTER TABLE public.flights OWNER TO osstest;

--
-- Name: flights_flight_seq; Type: SEQUENCE; Schema: public; Owner: osstest
--

CREATE SEQUENCE flights_flight_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.flights_flight_seq OWNER TO osstest;

--
-- Name: flights_flight_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: osstest
--

ALTER SEQUENCE flights_flight_seq OWNED BY flights.flight;


--
-- Name: flights_harness_touched; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE flights_harness_touched (
    flight integer NOT NULL,
    harness text NOT NULL
);


ALTER TABLE public.flights_harness_touched OWNER TO osstest;

--
-- Name: hostflags; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE hostflags (
    hostname text NOT NULL,
    hostflag text NOT NULL
);


ALTER TABLE public.hostflags OWNER TO osstest;

--
-- Name: jobs; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE jobs (
    flight integer NOT NULL,
    job character varying NOT NULL,
    recipe text,
    status text DEFAULT 'stopped'::text NOT NULL
);


ALTER TABLE public.jobs OWNER TO osstest;

--
-- Name: resource_log_evid_seq; Type: SEQUENCE; Schema: public; Owner: iwj
--

CREATE SEQUENCE resource_log_evid_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.resource_log_evid_seq OWNER TO iwj;

--
-- Name: resource_log; Type: TABLE; Schema: public; Owner: iwj; Tablespace: 
--

CREATE TABLE resource_log (
    restype text NOT NULL,
    resname text NOT NULL,
    shareix integer NOT NULL,
    evid integer DEFAULT nextval('resource_log_evid_seq'::regclass) NOT NULL,
    "timestamp" integer,
    taskid integer,
    flight integer,
    job character varying,
    stepno integer,
    evtype text NOT NULL,
    evcomment text NOT NULL
);


ALTER TABLE public.resource_log OWNER TO iwj;

--
-- Name: resource_properties; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE resource_properties (
    restype text NOT NULL,
    resname text NOT NULL,
    name text NOT NULL,
    val text NOT NULL
);


ALTER TABLE public.resource_properties OWNER TO osstest;

--
-- Name: resource_sharing; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE resource_sharing (
    restype text NOT NULL,
    resname text NOT NULL,
    sharetype text NOT NULL,
    wear integer DEFAULT 0 NOT NULL,
    state text NOT NULL,
    harness character varying
);


ALTER TABLE public.resource_sharing OWNER TO osstest;

--
-- Name: resources; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE resources (
    restype text NOT NULL,
    resname text NOT NULL,
    shareix integer DEFAULT 0 NOT NULL,
    owntaskid integer NOT NULL,
    subtask text DEFAULT ''::text NOT NULL,
    CONSTRAINT resources_check CHECK (((shareix = 0) OR (restype ~~ 'share-%'::text)))
);


ALTER TABLE public.resources OWNER TO osstest;

--
-- Name: runvars; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE runvars (
    flight integer NOT NULL,
    job character varying NOT NULL,
    name character varying NOT NULL,
    val character varying,
    synth boolean NOT NULL
);


ALTER TABLE public.runvars OWNER TO osstest;

--
-- Name: steps; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE steps (
    flight integer NOT NULL,
    job character varying NOT NULL,
    stepno integer NOT NULL,
    step character varying NOT NULL,
    status character varying NOT NULL,
    testid text,
    started integer,
    finished integer
);


ALTER TABLE public.steps OWNER TO osstest;

--
-- Name: tasks_taskid_seq; Type: SEQUENCE; Schema: public; Owner: osstest
--

CREATE SEQUENCE tasks_taskid_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.tasks_taskid_seq OWNER TO osstest;

--
-- Name: tasks; Type: TABLE; Schema: public; Owner: osstest; Tablespace: 
--

CREATE TABLE tasks (
    taskid integer DEFAULT nextval('tasks_taskid_seq'::regclass) NOT NULL,
    type text NOT NULL,
    refkey text NOT NULL,
    username text,
    comment text,
    live boolean NOT NULL,
    refinfo text
);


ALTER TABLE public.tasks OWNER TO osstest;

--
-- Name: flight; Type: DEFAULT; Schema: public; Owner: osstest
--

ALTER TABLE ONLY flights ALTER COLUMN flight SET DEFAULT nextval('flights_flight_seq'::regclass);


--
-- Name: flights_harness_touched_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY flights_harness_touched
    ADD CONSTRAINT flights_harness_touched_pkey PRIMARY KEY (flight, harness);


--
-- Name: flights_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY flights
    ADD CONSTRAINT flights_pkey PRIMARY KEY (flight);


--
-- Name: jobs_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY jobs
    ADD CONSTRAINT jobs_pkey PRIMARY KEY (flight, job);


--
-- Name: resource_log_pkey; Type: CONSTRAINT; Schema: public; Owner: iwj; Tablespace: 
--

ALTER TABLE ONLY resource_log
    ADD CONSTRAINT resource_log_pkey PRIMARY KEY (restype, resname, shareix, evid);


--
-- Name: resource_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY resource_properties
    ADD CONSTRAINT resource_properties_pkey PRIMARY KEY (restype, resname, name);


--
-- Name: resource_sharing_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY resource_sharing
    ADD CONSTRAINT resource_sharing_pkey PRIMARY KEY (restype, resname);


--
-- Name: resources_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY resources
    ADD CONSTRAINT resources_pkey PRIMARY KEY (restype, resname, shareix);


--
-- Name: runvars_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY runvars
    ADD CONSTRAINT runvars_pkey PRIMARY KEY (flight, job, name);


--
-- Name: steps_flight_key; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY steps
    ADD CONSTRAINT steps_flight_key UNIQUE (flight, job, testid);


--
-- Name: steps_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY steps
    ADD CONSTRAINT steps_pkey PRIMARY KEY (flight, job, stepno);


--
-- Name: tasks_pkey; Type: CONSTRAINT; Schema: public; Owner: osstest; Tablespace: 
--

ALTER TABLE ONLY tasks
    ADD CONSTRAINT tasks_pkey PRIMARY KEY (taskid);


--
-- Name: hostflags_flag_index; Type: INDEX; Schema: public; Owner: osstest; Tablespace: 
--

CREATE INDEX hostflags_flag_index ON hostflags USING btree (hostflag);


--
-- Name: hostflags_host_flag_index; Type: INDEX; Schema: public; Owner: osstest; Tablespace: 
--

CREATE INDEX hostflags_host_flag_index ON hostflags USING btree (hostname, hostflag);


--
-- Name: tasks_type_refkey_live_index; Type: INDEX; Schema: public; Owner: osstest; Tablespace: 
--

CREATE UNIQUE INDEX tasks_type_refkey_live_index ON tasks USING btree (type, refkey) WHERE live;


--
-- Name: tasks_type_taskid; Type: INDEX; Schema: public; Owner: osstest; Tablespace: 
--

CREATE INDEX tasks_type_taskid ON tasks USING btree (type, taskid);


--
-- Name: resource_log_flight_fkey; Type: FK CONSTRAINT; Schema: public; Owner: iwj
--

ALTER TABLE ONLY resource_log
    ADD CONSTRAINT resource_log_flight_fkey FOREIGN KEY (flight) REFERENCES flights(flight);


--
-- Name: resource_log_flight_fkey1; Type: FK CONSTRAINT; Schema: public; Owner: iwj
--

ALTER TABLE ONLY resource_log
    ADD CONSTRAINT resource_log_flight_fkey1 FOREIGN KEY (flight, job) REFERENCES jobs(flight, job);


--
-- Name: resource_log_flight_fkey2; Type: FK CONSTRAINT; Schema: public; Owner: iwj
--

ALTER TABLE ONLY resource_log
    ADD CONSTRAINT resource_log_flight_fkey2 FOREIGN KEY (flight, job, stepno) REFERENCES steps(flight, job, stepno);


--
-- Name: resource_log_restype_fkey; Type: FK CONSTRAINT; Schema: public; Owner: iwj
--

ALTER TABLE ONLY resource_log
    ADD CONSTRAINT resource_log_restype_fkey FOREIGN KEY (restype, resname, shareix) REFERENCES resources(restype, resname, shareix);


--
-- Name: resources_owntaskid_fkey; Type: FK CONSTRAINT; Schema: public; Owner: osstest
--

ALTER TABLE ONLY resources
    ADD CONSTRAINT resources_owntaskid_fkey FOREIGN KEY (owntaskid) REFERENCES tasks(taskid);


--
-- Name: steps_flight_fkey; Type: FK CONSTRAINT; Schema: public; Owner: osstest
--

ALTER TABLE ONLY steps
    ADD CONSTRAINT steps_flight_fkey FOREIGN KEY (flight, job) REFERENCES jobs(flight, job);


--
-- Name: public; Type: ACL; Schema: -; Owner: postgres
--

REVOKE ALL ON SCHEMA public FROM PUBLIC;
REVOKE ALL ON SCHEMA public FROM postgres;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO PUBLIC;


--
-- Name: flights; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE flights FROM PUBLIC;
REVOKE ALL ON TABLE flights FROM osstest;
GRANT ALL ON TABLE flights TO osstest;
GRANT SELECT ON TABLE flights TO osstest_ro;


--
-- Name: flights_flight_seq; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON SEQUENCE flights_flight_seq FROM PUBLIC;
REVOKE ALL ON SEQUENCE flights_flight_seq FROM osstest;
GRANT ALL ON SEQUENCE flights_flight_seq TO osstest;
GRANT SELECT ON SEQUENCE flights_flight_seq TO osstest_ro;


--
-- Name: flights_harness_touched; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE flights_harness_touched FROM PUBLIC;
REVOKE ALL ON TABLE flights_harness_touched FROM osstest;
GRANT ALL ON TABLE flights_harness_touched TO osstest;
GRANT SELECT ON TABLE flights_harness_touched TO osstest_ro;


--
-- Name: hostflags; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE hostflags FROM PUBLIC;
REVOKE ALL ON TABLE hostflags FROM osstest;
GRANT ALL ON TABLE hostflags TO osstest;
GRANT SELECT ON TABLE hostflags TO osstest_ro;


--
-- Name: jobs; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE jobs FROM PUBLIC;
REVOKE ALL ON TABLE jobs FROM osstest;
GRANT ALL ON TABLE jobs TO osstest;
GRANT SELECT ON TABLE jobs TO osstest_ro;


--
-- Name: resource_properties; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE resource_properties FROM PUBLIC;
REVOKE ALL ON TABLE resource_properties FROM osstest;
GRANT ALL ON TABLE resource_properties TO osstest;
GRANT SELECT ON TABLE resource_properties TO osstest_ro;


--
-- Name: resource_sharing; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE resource_sharing FROM PUBLIC;
REVOKE ALL ON TABLE resource_sharing FROM osstest;
GRANT ALL ON TABLE resource_sharing TO osstest;
GRANT SELECT ON TABLE resource_sharing TO osstest_ro;


--
-- Name: resources; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE resources FROM PUBLIC;
REVOKE ALL ON TABLE resources FROM osstest;
GRANT ALL ON TABLE resources TO osstest;
GRANT SELECT ON TABLE resources TO osstest_ro;


--
-- Name: runvars; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE runvars FROM PUBLIC;
REVOKE ALL ON TABLE runvars FROM osstest;
GRANT ALL ON TABLE runvars TO osstest;
GRANT SELECT ON TABLE runvars TO osstest_ro;


--
-- Name: steps; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE steps FROM PUBLIC;
REVOKE ALL ON TABLE steps FROM osstest;
GRANT ALL ON TABLE steps TO osstest;
GRANT SELECT ON TABLE steps TO osstest_ro;


--
-- Name: tasks_taskid_seq; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON SEQUENCE tasks_taskid_seq FROM PUBLIC;
REVOKE ALL ON SEQUENCE tasks_taskid_seq FROM osstest;
GRANT ALL ON SEQUENCE tasks_taskid_seq TO osstest;
GRANT SELECT ON SEQUENCE tasks_taskid_seq TO osstest_ro;


--
-- Name: tasks; Type: ACL; Schema: public; Owner: osstest
--

REVOKE ALL ON TABLE tasks FROM PUBLIC;
REVOKE ALL ON TABLE tasks FROM osstest;
GRANT ALL ON TABLE tasks TO osstest;
GRANT SELECT ON TABLE tasks TO osstest_ro;


--
-- PostgreSQL database dump complete
--

